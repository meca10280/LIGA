<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <title>LIGA - Experiencia inmersiva</title>
    <script src="js/aframe.min.js"></script>
    <script src="js/aframe-ar.js"></script>       
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
        }
        
        .ar-info {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px;
            border-radius: 5px;
            z-index: 1000;
            font-size: 14px;
        }
        
        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 20px;
            border-radius: 10px;
            z-index: 1001;
        }
    </style>
</head>
<body>
    <!-- Loading indicator -->
    <div id="loading" class="loading">
        <p>Loading AR Camera...</p>
        <p>Point your camera at a Hiro marker</p>
    </div>
    
    <!-- AR Info Panel -->
    <div class="ar-info">
        <div>AR.js Hiro Marker Detection</div>
        <div id="marker-status">Searching for marker...</div>
    </div>

    <!-- A-Frame AR Scene -->
    <a-scene
        vr-mode-ui="enabled: false"
        renderer="logarithmicDepthBuffer: true; colorManagement: true; sortObjects: true"
        arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
        embedded
        gesture-detector
        id="scene">
        
        <!-- Assets -->
        <a-assets>
            <!-- Define reusable materials -->
            <a-mixin id="text-style" 
                     text="font: roboto; 
                           align: center; 
                           anchor: center; 
                           baseline: center;
                           color: white;
                           shader: msdf;
                           transparent: true;
                           alphaTest: 0.5"></a-mixin>
        </a-assets>

        <!-- Hiro Marker -->
        <a-marker 
            id="hiro-marker"
            preset="hiro" 
            raycaster="objects: .clickable"
            emitevents="true"
            cursor="fuse: false; rayOrigin: mouse"
            markerhandler>
            
            <!-- Dark background plane -->
            <a-plane 
                id="text-background"
                position="0 0 0.01" 
                rotation="-90 0 0" 
                width="3" 
                height="1.5" 
                color="#1a1a1a" 
                opacity="0.9"
                material="transparent: true"
                class="clickable">
            </a-plane>
            
            <!-- Main title text -->
            <a-text 
                id="main-text"
                mixin="text-style"
                value="AR Text Projection"
                position="0 0.3 0.02"
                rotation="-90 0 0"
                scale="1.2 1.2 1.2"
                text="color: #00ff88; font: roboto"
                class="clickable">
            </a-text>
            
            <!-- Subtitle text -->
            <a-text 
                id="sub-text"
                mixin="text-style"
                value="Hiro Marker Detected!"
                position="0 0 0.02"
                rotation="-90 0 0"
                scale="0.8 0.8 0.8"
                text="color: #ffffff; font: roboto">
            </a-text>
            
            <!-- Dynamic info text -->
            <a-text 
                id="info-text"
                mixin="text-style"
                value="Tap to interact"
                position="0 -0.3 0.02"
                rotation="-90 0 0"
                scale="0.6 0.6 0.6"
                text="color: #ffaa00; font: roboto"
                class="clickable">
            </a-text>
            
            <!-- Optional: Add a subtle border -->
            <a-ring 
                position="0 0 0.015"
                rotation="-90 0 0"
                radius-inner="1.4"
                radius-outer="1.5"
                color="#00ff88"
                opacity="0.6"
                material="transparent: true">
            </a-ring>
            
        </a-marker>

        <!-- Camera -->
        <a-entity camera></a-entity>
    </a-scene>

    <script>
        // Custom component for marker event handling
        AFRAME.registerComponent('markerhandler', {
            init: function () {
                const marker = this.el;
                const statusElement = document.getElementById('marker-status');
                const loadingElement = document.getElementById('loading');
                
                // Marker found event
                marker.addEventListener('markerFound', function() {
                    console.log('Hiro marker detected!');
                    statusElement.textContent = 'Hiro marker detected!';
                    statusElement.style.color = '#00ff88';
                    
                    // Hide loading indicator
                    if (loadingElement) {
                        loadingElement.style.display = 'none';
                    }
                    
                    // Animate text appearance
                    animateTextAppearance();
                });

                // Marker lost event
                marker.addEventListener('markerLost', function() {
                    console.log('Hiro marker lost');
                    statusElement.textContent = 'Searching for marker...';
                    statusElement.style.color = '#ffaa00';
                    
                    // Reset text animations
                    resetTextAnimations();
                });
            }
        });

        // Gesture detector component for touch interactions
        AFRAME.registerComponent('gesture-detector', {
            schema: {
                element: {default: ''}
            },
            init: function() {
                this.targetElement = this.data.element || this.el;
                this.internalState = {
                    previousState: null
                };
                this.emitGestureEvent = this.emitGestureEvent.bind(this);
                this.targetElement.addEventListener('touchstart', this.emitGestureEvent);
                this.targetElement.addEventListener('touchend', this.emitGestureEvent);
            },
            emitGestureEvent(event) {
                this.el.emit('gesture-detected', {
                    state: event.type,
                    originalEvent: event
                });
            }
        });

        // Animation functions
        function animateTextAppearance() {
            const mainText = document.getElementById('main-text');
            const subText = document.getElementById('sub-text');
            const infoText = document.getElementById('info-text');
            const background = document.getElementById('text-background');
            
            // Animate background
            background.setAttribute('animation', {
                property: 'scale',
                from: '0.1 0.1 0.1',
                to: '1 1 1',
                dur: 800,
                easing: 'easeOutElastic'
            });
            
            // Animate texts with delays
            setTimeout(() => {
                mainText.setAttribute('animation', {
                    property: 'scale',
                    from: '0.1 0.1 0.1',
                    to: '1.2 1.2 1.2',
                    dur: 600,
                    easing: 'easeOutBack'
                });
            }, 200);
            
            setTimeout(() => {
                subText.setAttribute('animation', {
                    property: 'scale',
                    from: '0.1 0.1 0.1',
                    to: '0.8 0.8 0.8',
                    dur: 600,
                    easing: 'easeOutBack'
                });
            }, 400);
            
            setTimeout(() => {
                infoText.setAttribute('animation', {
                    property: 'scale',
                    from: '0.1 0.1 0.1',
                    to: '0.6 0.6 0.6',
                    dur: 600,
                    easing: 'easeOutBack'
                });
            }, 600);
        }

        function resetTextAnimations() {
            const elements = ['main-text', 'sub-text', 'info-text', 'text-background'];
            elements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.removeAttribute('animation');
                }
            });
        }

        // Click interaction handler
        document.addEventListener('DOMContentLoaded', function() {
            const scene = document.getElementById('scene');
            
            scene.addEventListener('click', function(event) {
                const intersectedEl = event.detail.intersectedEl;
                if (intersectedEl && intersectedEl.classList.contains('clickable')) {
                    handleTextInteraction(intersectedEl);
                }
            });
            
            // Touch interaction for mobile
            scene.addEventListener('gesture-detected', function(event) {
                if (event.detail.state === 'touchend') {
                    cycleTextContent();
                }
            });
        });

        // Interactive text content cycling
        const textVariations = [
            {
                main: "AR Text Projection",
                sub: "Hiro Marker Detected!",
                info: "Tap to interact"
            },
            {
                main: "Welcome to AR!",
                sub: "Interactive Experience",
                info: "Touch anywhere"
            },
            {
                main: "AR.js Demo",
                sub: "Marker Tracking Active",
                info: "Keep marker visible"
            }
        ];

        let currentTextIndex = 0;

        function handleTextInteraction(element) {
            console.log('Element clicked:', element.id);
            cycleTextContent();
        }

        function cycleTextContent() {
            currentTextIndex = (currentTextIndex + 1) % textVariations.length;
            const currentText = textVariations[currentTextIndex];
            
            const mainText = document.getElementById('main-text');
            const subText = document.getElementById('sub-text');
            const infoText = document.getElementById('info-text');
            
            if (mainText) mainText.setAttribute('text', 'value', currentText.main);
            if (subText) subText.setAttribute('text', 'value', currentText.sub);
            if (infoText) infoText.setAttribute('text', 'value', currentText.info);
            
            // Add a brief scale animation for feedback
            [mainText, subText, infoText].forEach(el => {
                if (el) {
                    el.setAttribute('animation__click', {
                        property: 'scale',
                        from: el.getAttribute('scale'),
                        to: '1.1 1.1 1.1',
                        dur: 200,
                        dir: 'alternate',
                        loop: 1
                    });
                }
            });
        }

        // Hide loading screen after scene loads
        window.addEventListener('load', function() {
            setTimeout(() => {
                const loading = document.getElementById('loading');
                if (loading && !document.getElementById('hiro-marker').object3D.visible) {
                    loading.style.opacity = '0.7';
                }
            }, 3000);
        });
    </script>
</body>
</html>
